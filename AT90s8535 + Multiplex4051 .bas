'======================================================================='

' Title: Multiplex4051 LED Clock
' Last Updated :  04.2022
' Author : A.Hossein.Khalilian
' Program code  : BASCOM-AVR 2.0.8.5
' Hardware req. : AT90s8535 + Multiplex4051

'======================================================================='

$regfile = "8535def.dat"
$crystal = 1000000
Config Portd = Output
Config Portb = Output
Config Portc = Output
Config Porta = Output

Enable Interrupts
Config Clock = Soft , Gosub = Sectic
Config Date = Ymd
Time$ = "23:59:00"

Dim A As Byte , B As Byte , C As Byte , D As Byte , F As Byte
Dim Day As Byte , Mounth As Byte , Year As Byte
Portb = 255

D = 1
Day = 31
Year = 85
Mounth = 6

'-----------------------------------------------------------

Main:
Do
A = _sec + _min
A = A + _hour
If A = 0 Then
  Incr Day
  If Day = 32 Then
   Day = 1
   Incr Mounth
   End If
    If Mounth > 6 Then
      If Day = 31 Then
      Day = 1
      Incr Mounth
         If Mounth = 13 Then
         Incr Year
         Mounth = 1
         End If
      End If
    End If
    Wait 2
End If
A = _sec
Gosub Second
A = _min
Gosub Minute
A = _hour
Gosub Hour
A = Day
Gosub Days
A = Mounth
Gosub Mont
Loop
End

'-----------------------------------------------------------

Sectic:
 If Portc.5 = 1 Then
 Portc.5 = 0
 Else
 Portc.5 = 1
 End If
 Porta = Lookup(_sec , Dta1)
Return


''''''''''''''''''''''''''''''

Second:
Gosub Sx
Reset Portb.0
Portd = Lookup(c , Dta)
Waitms D
Set Portb.0
Reset Portb.1
Portd = Lookup(b , Dta)
Waitms D
Set Portb.1
Return


''''''''''''''''''''''''''''''

Minute:
Gosub Sx
Reset Portb.2
Portd = Lookup(c , Dta)
Waitms D
Set Portb.2
Reset Portb.3
Portd = Lookup(b , Dta)
Waitms D
Set Portb.3
Return


''''''''''''''''''''''''''''''

Hour:
Gosub Sx
Reset Portb.4
Portd = Lookup(c , Dta)
Waitms D
Set Portb.4
Reset Portb.5
Portd = Lookup(b , Dta)
Waitms D
Set Portb.5
Return


''''''''''''''''''''''''''''''

Days:
Gosub Sx
Reset Portb.6
Portd = Lookup(c , Dta)
Waitms D
Set Portb.6
Reset Portb.7
Portd = Lookup(b , Dta)
Waitms D
Set Portb.7
Return


''''''''''''''''''''''''''''''

Mont:
Gosub Sx
Reset Portc.0
Portd = Lookup(c , Dta)
Waitms D
Set Portc.0
Reset Portc.1
Portd = Lookup(b , Dta)
Waitms D
Set Portc.1
Return


''''''''''''''''''''''''''''''

Sx:
B = A / 10
C = B * 10
C = A - C
Return


''''''''''''''''''''''''''''''

Dta:
Data &B1111110 , &B110000 , &B1101101 , &B1111001 , &B110011
Data &B1011011 , &B1011111 , &B1110000 , &B1111111 , &B1111011


''''''''''''''''''''''''''''''

Dta1:
Data 0 , 8 , 16 , 24 , 32 , 40 , 48 , 56
Data 1 , 9 , 17 , 25 , 33 , 41 , 49 , 57
Data 2 , 10 , 18 , 26 , 34 , 42 , 50 , 58
Data 3 , 11 , 19 , 27 , 35 , 43 , 51 , 59
Data 4 , 12 , 20 , 28 , 36 , 44 , 52 , 60
Data 5 , 13 , 21 , 29 , 37 , 45 , 53 , 61
Data 6 , 14 , 22 , 30 , 38 , 46 , 54 , 62
Data 7 , 15 , 23 , 31


''''''''''''''''''''''''''''''

dat1:
Data 408 , 407 , 405 , 403 , 402 , 400 , 359 , 357 , 356 , 354,
Data 352 , 351 , 349 , 347 , 346 , 344 , 343 , 341 , 339 , 338,
Data 336 , 334 , 333 , 331 , 330 , 328 , 326 , 325 , 323 , 321,
Data 320 , 318 , 317 , 315 , 314 , 312 , 311 , 309 , 308 , 306,
Data 305 , 303 , 302 , 300 , 259 , 257 , 256 , 255 , 253 , 252,
Data 251 , 249 , 248 , 247 , 246 , 244 , 243 , 242 , 241 , 240,
Data 239 , 238 , 237 , 236 , 235 , 234 , 233 , 232 , 231 , 231,
Data 230 , 229 , 229 , 228 , 227 , 227 , 226 , 226 , 225 , 225,
Data 225 , 224 , 224 , 224 , 224 , 224 , 224 , 224 , 224 , 224,
Data 224 , 224 , 224 , 224 , 225 , 225 , 225 , 226 , 226 , 227,
Data 227 , 228 , 228 , 229 , 230 , 230 , 231 , 232 , 233 , 233,
Data 234 , 235 , 236 , 237 , 238 , 239 , 240 , 241 , 242 , 243,
Data 244 , 245 , 246 , 247 , 248 , 249 , 251 , 252 , 253 , 254,
Data 255 , 256 , 257 , 259 , 300 , 301 , 302 , 303 , 305 , 306,
Data 307 , 308 , 309 , 310 , 312 , 313 , 314 , 315 , 316 , 317,
Data 318 , 320 , 321 , 322 , 323 , 324 , 325 , 326 , 327 , 328,
Data 329 , 330 , 331 , 333 , 334 , 335 , 336 , 337 , 338 , 339,
Data 340 , 341 , 342 , 343 , 343 , 344 , 345 , 346 , 347 , 348,
Data 349 , 350 , 351 , 352 , 353 , 354 , 354 , 355 , 356 , 357,
Data 358 , 359 , 400 , 401 , 401 , 402 , 403 , 404 , 405 , 406,
Data 407 , 407 , 408 , 409 , 410 , 411 , 412 , 412 , 413 , 414,
Data 415 , 416 , 417 , 418 , 418 , 419 , 420 , 421 , 422 , 423,
Data 424 , 424 , 425 , 426 , 427 , 428 , 429 , 430 , 430 , 431,
Data 432 , 433 , 434 , 435 , 436 , 437 , 438 , 438 , 439 , 440,
Data 441 , 442 , 443 , 444 , 445 , 445 , 446 , 447 , 448 , 449,
Data 450 , 451 , 451 , 452 , 453 , 454 , 455 , 455 , 456 , 457,
Data 458 , 458 , 459 , 500 , 501 , 501 , 502 , 503 , 503 , 504,
Data 505 , 505 , 506 , 506 , 507 , 507 , 508 , 508 , 509 , 509,
Data 510 , 510 , 510 , 511 , 511 , 511 , 511 , 512 , 512 , 512,
Data 512 , 512 , 513 , 513 , 513 , 513 , 513 , 513 , 513 , 513,
Data 512 , 512 , 512 , 512 , 512 , 511 , 511 , 511 , 510 , 510,
Data 510 , 509 , 509 , 508 , 508 , 507 , 507 , 506 , 505 , 505,
Data 504 , 503 , 502 , 502 , 501 , 500 , 459 , 458 , 457 , 456,
Data 456 , 455 , 454 , 452 , 451 , 450 , 449 , 446 , 447 , 446,
Data 445 , 443 , 442 , 441 , 440 , 438 , 437 , 436 , 435 , 433,
Data 432 , 430 , 429 , 428 , 426 , 425 , 423 , 422 , 420 , 419,
Data 417 , 416 , 414 , 413 , 411 , 000 , 000 , 000 , 000 , 000


''''''''''''''''''''''''''''''

Dat2:
Data 408 , 407 , 405 , 403 , 402 , 400 , 359 , 357 , 356 , 354,
Data 352 , 351 , 349 , 347 , 346 , 344 , 343 , 341 , 339 , 338,
Data 336 , 334 , 333 , 331 , 330 , 328 , 326 , 325 , 323 , 321,
Data 320 , 318 , 317 , 315 , 314 , 312 , 311 , 309 , 308 , 306,
Data 305 , 303 , 302 , 300 , 259 , 257 , 256 , 255 , 253 , 252,
Data 251 , 249 , 248 , 247 , 246 , 244 , 243 , 242 , 241 , 240,
Data 239 , 238 , 237 , 236 , 235 , 234 , 233 , 232 , 231 , 231,
Data 230 , 229 , 229 , 228 , 227 , 227 , 226 , 226 , 225 , 225,
Data 225 , 224 , 224 , 224 , 224 , 224 , 224 , 224 , 224 , 224,
Data 224 , 224 , 224 , 224 , 225 , 225 , 225 , 226 , 226 , 227,
Data 227 , 228 , 228 , 229 , 230 , 230 , 231 , 232 , 233 , 233,
Data 234 , 235 , 236 , 237 , 238 , 239 , 240 , 241 , 242 , 243,
Data 244 , 245 , 246 , 247 , 248 , 249 , 251 , 252 , 253 , 254,
Data 255 , 256 , 257 , 259 , 300 , 301 , 302 , 303 , 305 , 306,
Data 307 , 308 , 309 , 310 , 312 , 313 , 314 , 315 , 316 , 317,
Data 318 , 320 , 321 , 322 , 323 , 324 , 325 , 326 , 327 , 328,
Data 329 , 330 , 331 , 333 , 334 , 335 , 336 , 337 , 338 , 339,
Data 340 , 341 , 342 , 343 , 343 , 344 , 345 , 346 , 347 , 348,
Data 349 , 350 , 351 , 352 , 353 , 354 , 354 , 355 , 356 , 357,
Data 358 , 359 , 400 , 401 , 401 , 402 , 403 , 404 , 405 , 406,
Data 407 , 407 , 408 , 409 , 410 , 411 , 412 , 412 , 413 , 414,
Data 415 , 416 , 417 , 418 , 418 , 419 , 420 , 421 , 422 , 423,
Data 424 , 424 , 425 , 426 , 427 , 428 , 429 , 430 , 430 , 431,
Data 432 , 433 , 434 , 435 , 436 , 437 , 438 , 438 , 439 , 440,
Data 441 , 442 , 443 , 444 , 445 , 445 , 446 , 447 , 448 , 449,
Data 450 , 451 , 451 , 452 , 453 , 454 , 455 , 455 , 456 , 457,
Data 458 , 458 , 459 , 500 , 501 , 501 , 502 , 503 , 503 , 504,
Data 505 , 505 , 506 , 506 , 507 , 507 , 508 , 508 , 509 , 509,
Data 510 , 510 , 510 , 511 , 511 , 511 , 511 , 512 , 512 , 512,
Data 512 , 512 , 513 , 513 , 513 , 513 , 513 , 513 , 513 , 513,
Data 512 , 512 , 512 , 512 , 512 , 511 , 511 , 511 , 510 , 510,
Data 510 , 509 , 509 , 508 , 508 , 507 , 507 , 506 , 505 , 505,
Data 504 , 503 , 502 , 502 , 501 , 500 , 459 , 458 , 457 , 456,
Data 456 , 455 , 454 , 452 , 451 , 450 , 449 , 446 , 447 , 446,
Data 445 , 443 , 442 , 441 , 440 , 438 , 437 , 436 , 435 , 433,
Data 432 , 430 , 429 , 428 , 426 , 425 , 423 , 422 , 420 , 419,
Data 417 , 416 , 414 , 413 , 411 , 000 , 000 , 000 , 000 , 000


''''''''''''''''''''''''''''''

dat3:
Data 408 , 407 , 405 , 403 , 402 , 400 , 359 , 357 , 356 , 354,
Data 352 , 351 , 349 , 347 , 346 , 344 , 343 , 341 , 339 , 338,
Data 336 , 334 , 333 , 331 , 330 , 328 , 326 , 325 , 323 , 321,
Data 320 , 318 , 317 , 315 , 314 , 312 , 311 , 309 , 308 , 306,
Data 305 , 303 , 302 , 300 , 259 , 257 , 256 , 255 , 253 , 252,
Data 251 , 249 , 248 , 247 , 246 , 244 , 243 , 242 , 241 , 240,
Data 239 , 238 , 237 , 236 , 235 , 234 , 233 , 232 , 231 , 231,
Data 230 , 229 , 229 , 228 , 227 , 227 , 226 , 226 , 225 , 225,
Data 225 , 224 , 224 , 224 , 224 , 224 , 224 , 224 , 224 , 224,
Data 224 , 224 , 224 , 224 , 225 , 225 , 225 , 226 , 226 , 227,
Data 227 , 228 , 228 , 229 , 230 , 230 , 231 , 232 , 233 , 233,
Data 234 , 235 , 236 , 237 , 238 , 239 , 240 , 241 , 242 , 243,
Data 244 , 245 , 246 , 247 , 248 , 249 , 251 , 252 , 253 , 254,
Data 255 , 256 , 257 , 259 , 300 , 301 , 302 , 303 , 305 , 306,
Data 307 , 308 , 309 , 310 , 312 , 313 , 314 , 315 , 316 , 317,
Data 318 , 320 , 321 , 322 , 323 , 324 , 325 , 326 , 327 , 328,
Data 329 , 330 , 331 , 333 , 334 , 335 , 336 , 337 , 338 , 339,
Data 340 , 341 , 342 , 343 , 343 , 344 , 345 , 346 , 347 , 348,
Data 349 , 350 , 351 , 352 , 353 , 354 , 354 , 355 , 356 , 357,
Data 358 , 359 , 400 , 401 , 401 , 402 , 403 , 404 , 405 , 406,
Data 407 , 407 , 408 , 409 , 410 , 411 , 412 , 412 , 413 , 414,
Data 415 , 416 , 417 , 418 , 418 , 419 , 420 , 421 , 422 , 423,
Data 424 , 424 , 425 , 426 , 427 , 428 , 429 , 430 , 430 , 431,
Data 432 , 433 , 434 , 435 , 436 , 437 , 438 , 438 , 439 , 440,
Data 441 , 442 , 443 , 444 , 445 , 445 , 446 , 447 , 448 , 449,
Data 450 , 451 , 451 , 452 , 453 , 454 , 455 , 455 , 456 , 457,
Data 458 , 458 , 459 , 500 , 501 , 501 , 502 , 503 , 503 , 504,
Data 505 , 505 , 506 , 506 , 507 , 507 , 508 , 508 , 509 , 509,
Data 510 , 510 , 510 , 511 , 511 , 511 , 511 , 512 , 512 , 512,
Data 512 , 512 , 513 , 513 , 513 , 513 , 513 , 513 , 513 , 513,
Data 512 , 512 , 512 , 512 , 512 , 511 , 511 , 511 , 510 , 510,
Data 510 , 509 , 509 , 508 , 508 , 507 , 507 , 506 , 505 , 505,
Data 504 , 503 , 502 , 502 , 501 , 500 , 459 , 458 , 457 , 456,
Data 456 , 455 , 454 , 452 , 451 , 450 , 449 , 446 , 447 , 446,
Data 445 , 443 , 442 , 441 , 440 , 438 , 437 , 436 , 435 , 433,
Data 432 , 430 , 429 , 428 , 426 , 425 , 423 , 422 , 420 , 419,
Data 417 , 416 , 414 , 413 , 411 , 000 , 000 , 000 , 000 , 000

'-----------------------------------------------------------